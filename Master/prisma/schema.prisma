// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  ADMIN
  MANAGER
  RECRUITER
}

enum JobSource {
  LINKEDIN
  INDEED
  NAUKRI
}

enum ApplicationStage {
  IDENTIFIED
  RESUME_UPDATED
  COLD_MESSAGE_SENT
  CONNECTION_ACCEPTED
  APPLIED
  INTERVIEW_SCHEDULED
  OFFER
  REJECTED
  CLOSED
}

enum JobStatus {
  ACTIVE
  CLOSED
  FILLED
}

enum NotificationType {
  FOLLOW_UP_REMINDER
  INTERVIEW_ALERT
  OVERDUE_TASK
  AI_INSIGHT
  JOB_SCRAPE_CONFIRMATION
}

enum NotificationChannel {
  WHATSAPP
  EMAIL
  IN_APP
}

enum FileType {
  RESUME
  DOCUMENT
  IMAGE
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  firstName String
  lastName  String
  role      UserRole @default(RECRUITER)
  managerId String?  // For manager-recruiter relationship
  isActive  Boolean  @default(true)
  lastLogin DateTime?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  jobs              Job[]
  candidates        Candidate[]
  applications      Application[]
  notifications     Notification[]
  auditLogs         AuditLog[]
  managedRecruiters User[]        @relation("ManagerRecruiter")
  manager           User?         @relation("ManagerRecruiter", fields: [managerId], references: [id])

  @@map("users")
}

model Job {
  id               String     @id @default(cuid())
  title            String
  company          String
  location         String
  description      String     @db.Text
  source           JobSource
  sourceUrl        String?
  skills           String[]   // Array of skills
  experienceRequired String?
  salaryRange      String?
  status           JobStatus  @default(ACTIVE)
  recruiterId      String
  notes            String?    @db.Text
  createdAt        DateTime   @default(now())
  updatedAt        DateTime   @updatedAt

  // Relations
  recruiter    User          @relation(fields: [recruiterId], references: [id], onDelete: Cascade)
  applications Application[]

  @@map("jobs")
}

model Candidate {
  id                  String   @id @default(cuid())
  firstName           String
  lastName            String
  email               String
  phone               String?
  linkedinUrl         String?
  tags                String[] // Array of tags
  notes               String?  @db.Text
  assignedRecruiterId String
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  // Relations
  assignedRecruiter User          @relation(fields: [assignedRecruiterId], references: [id], onDelete: Cascade)
  applications      Application[]
  resumes           Resume[]

  @@map("candidates")
}

model Application {
  id          String           @id @default(cuid())
  jobId       String
  candidateId String
  stage       ApplicationStage @default(IDENTIFIED)
  recruiterId String
  notes       String?          @db.Text
  followUpDate DateTime?
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt

  // Relations
  job      Job      @relation(fields: [jobId], references: [id], onDelete: Cascade)
  candidate Candidate @relation(fields: [candidateId], references: [id], onDelete: Cascade)
  recruiter User    @relation(fields: [recruiterId], references: [id], onDelete: Cascade)

  @@unique([jobId, candidateId])
  @@map("applications")
}

model Resume {
  id          String   @id @default(cuid())
  candidateId String
  fileUrl     String
  fileName    String
  fileSize    Int      // in bytes
  version     Int      @default(1)
  uploadedBy  String
  uploadedAt  DateTime @default(now())

  // Relations
  candidate Candidate @relation(fields: [candidateId], references: [id], onDelete: Cascade)

  @@map("resumes")
}

model Notification {
  id        String            @id @default(cuid())
  userId    String
  type      NotificationType
  channel   NotificationChannel
  title     String
  message   String            @db.Text
  read      Boolean           @default(false)
  sent      Boolean           @default(false)
  sentAt    DateTime?
  createdAt DateTime          @default(now())

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("notifications")
}

model AuditLog {
  id        String   @id @default(cuid())
  userId    String
  action    String   // e.g., "CREATE_JOB", "UPDATE_CANDIDATE"
  entity    String   // e.g., "Job", "Candidate"
  entityId  String?
  details   String?  @db.Text
  ipAddress String?
  userAgent String?
  createdAt DateTime @default(now())

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("audit_logs")
}

model File {
  id        String   @id @default(cuid())
  fileName  String
  fileUrl   String
  fileType  FileType
  fileSize  Int      // in bytes
  mimeType  String
  uploadedBy String
  createdAt DateTime @default(now())

  @@map("files")
}

